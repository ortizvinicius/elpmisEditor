!function(e,t){"use strict";function n(e,t,n){t.forEach(function(t){e.addEventListener(t,n)})}var i=[],s={autoInit:!0,silentMode:!1,wysiwyg:!0,textMode:!0,keyListen:!0,types:["basic","header","blocks","lists","special","colors","hyperlink"],basic:["strong","em","mark","sup","sub","del","br"],header:["h1","h2","h3","h4","h5","h6"],blocks:["p","blockquote","pre"],lists:["ul","ol","dl"],special:["abbr","code","hr"],colors:"class",hyperlink:!0},o=function(){function e(e,n){var i=t[e];return n&&n.forEach(function(e,t){i=i.split("{{"+t+"}}").join(e)}),i}var t=["The element {{0}} is already been used. Use the destroy method before set it again.","Cannot add a customComponent to an element already started, set the autoInit option to false, add the customComponent then use init() or initAll(). You can look at the status property to check if the element was already started."];return function(t,n){this.name="ElpmisError",this.code=t,this.message=e(t,n),this.logError=function(){console.error(this.name+":",this.code,this.message)}}}(),r=function(){var e=1;return function(t,n){"object"==typeof t&&null!==t&&(this.name=t.name||"customComponent"+e,this.element=t.element||"span",this.class=t.class||"customClass"+e,this.type=n.indexOf(t.type)>-1?t.type:"special",e++)}}(),a=function(e){var i=t.createElement("div"),s=this;i.classList.add("elpmisWysiwygElement"),i.id="elpmisWysiwygElement"+e.elpmisId,i.setAttribute("contenteditable",!0),this.updateWysiwyg=function(){i.innerHTML=e.value},this.updateTextarea=function(){e.value=i.innerHTML},this.add=function(){t.body.insertBefore(i,e)},this.watch=function(){n(e,["input","change","keyup","keydown","keypress"],function(){s.updateWysiwyg()}),n(i,["input","change","keyup","keydown","keypress"],function(){s.updateTextarea()})},this.updateWysiwyg()},l=function(e,n){function l(e){if(g){if(!b.silentMode)throw new o(1);new o(1).logError()}else{e="object"==typeof e?e:{};var t=new r(e,b.types);t&&k.push(t)}}function c(e){e.addEventListener("keypress",function(t){var n=t.which||t.keyCode,i=t.shiftKey;b.blocks.indexOf("p")>-1&&(13!==n||i||(t.preventDefault(),u(e,{element:"p",newLineBefore:!0,inline:!1}))),b.basic.indexOf("br")>-1&&13===n&&i&&(t.preventDefault(),u(e,{element:"br",newLineAfter:!0,close:!1}))})}function u(e,t){if(e){t="object"==typeof t?t:{},t.element=t.element||"p",t.newLineBefore=!!t.hasOwnProperty("newLineBefore")&&t.newLineBefore,t.newLineAfter=!!t.hasOwnProperty("newLineAfter")&&t.newLineAfter,t.close=!t.hasOwnProperty("close")||t.close,t.inline=!t.hasOwnProperty("inline")||t.inline;var n=e.selectionStart,i=0,s=e.selectionEnd,o=e.value,r="";t.inline?(r=o.substring(0,n),r+=t.newLineBefore?"\n":"",r+="<"+t.element+">",r+=o.substring(n,s),t.newLineBefore&&(i=r.length),r+=t.close?"</"+t.element+">":"",r+=t.newLineAfter?"\n":"",t.newLineAfter&&(i=r.length),r+=o.substring(s)):(r=o,r+=t.newLineBefore?"\n":"",r+="<"+t.element+">",t.newLineBefore&&(i=r.length),r+=t.close?"</"+t.element+">":"",r+=t.newLineAfter?"\n":"",t.newLineAfter&&(i=r.length)),e.value=r,e.selectionStart=e.selectionEnd=i}}function f(e){var t=e.elpmisId;v[t]=new a(e),v[t].add(),v[t].watch()}function h(e){g||(g=!0),b.keyListen&&c(e),b.wysiwyg&&f(e)}function d(){E.forEach(h)}function p(){i[y]=!1;var e=Object.keys(this);e.forEach(function(e){delete this[e]},this)}var y=e||".elpmis",m=y.substr(0,1),w=y.substr(1),b={},g=!1,E=[],L=!1,k=[],v=[];if("object"==typeof n&&null!==n?Object.keys(s).forEach(function(e){n.hasOwnProperty(e)?b[e]=n[e]:b[e]=s[e]}):b=s,!i[y]){switch(i[y]=!0,m){case"#":E[0]=t.getElementById(w);break;case".":L=t.getElementsByClassName(w);break;default:L=t.getElementsByTagName(y)}return L&&Array.prototype.forEach.call(L,function(e){E.push(e)}),E.forEach(function(e,t){e.elpmisId=t}),b.autoInit&&d(),{status:g,selector:y,options:b,elements:E,customComponents:k,wysiwygElements:v,destroy:p,addCustomComponent:l,init:h,initAll:d,addHTMLElement:u}}if(!b.silentMode)throw new o(0,[y]);new o(0,[y]).logError()};e.ElpmisEditor=l}(window,document);