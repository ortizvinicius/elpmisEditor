!function(e,t){"use strict";function i(e,t,i){t.forEach(function(t){e.addEventListener(t,i)})}function n(e,t){var i=Object.create(c);return i.init(e,t),i}var s=[],o={autoInit:!0,silentMode:!0,previewMode:!0,keyListen:!0,types:["basic","header","blocks","lists","special","colors","hyperlink"],basic:["strong","em","mark","sup","sub","del","br"],header:["h1","h2","h3","h4","h5","h6"],blocks:["p","blockquote","pre"],lists:["ul","ol","dl"],special:["abbr","code","hr"],css:"class",hyperlink:!0},l={customComponentsLength:0,element:"span",type:"special",init:function(e,t){"object"==typeof e&&null!==e&&(this.id=++l.customComponentsLength,this.name=e.name||"customComponent"+this.id,e.element&&(this.element=e.element),this.class=e.class||"customClass"+this.id,t.indexOf(e.type)>-1&&(this.type=e.type),this.init=function(){return!1})}},c=Object.create(Error.prototype);Object.defineProperties(c,{name:{enumerable:!0,value:"ElpmisError"},started:{writable:!0,value:!1},messages:{value:["The number was not defined.","The element {{0}} is already been used. Use the destroy method before set it again.","Cannot add a customComponent to an element already started, set the autoInit option to false, add the customComponent then use init() or initAll(). You can look at the status property to check if the element was already started."]},message:{enumerable:!0,get:function(){if(this.started){var e=this.messages[this.number];return this.placeholders&&this.placeholders.forEach(function(t,i){e=e.split("{{"+i+"}}").join(t)}),e}return!1}},init:{value:function(e,t){this.started||(this.started=!0,this.number=e,this.placeholders=t)}}});var a={blocks:{},init:function(e,i){return"object"==typeof i&&(this.config=i,this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisFormatBar"),this.domElement.id="elpmisFormatBar"+this.textareaElement.elpmisId,this.init=function(){return!1},!0)},addToDOM:function(){this.init()||t.body.insertBefore(this.domElement,this.textareaElement)},addBlocks:function(){if(!this.init()){var e=this;this.config.types.indexOf("basic")>-1&&(this.blocks.basic={},this.blocks.basic.domElement=t.createElement("div"),this.blocks.basic.domElement.classList.add("elpmisFormatBar-basicBlock"),this.blocks.basic.domElement.id="elpmisFormatBar-basicBlock"+this.textareaElement.elpmisId,this.config.hasOwnProperty("basic")&&"object"==typeof this.config.basic&&this.config.basic.forEach(function(i){var n={};this.config.basic[i]=t.createElement("button"),this.config.basic[i].classList.add("elpmisFormatBar-basicBlock-"+i+"Button"),this.config.basic[i].id="elpmisFormatBar-basicBlock-"+i+"Button"+this.textareaElement.elpmisId,n.element=i,"strong"===i?(this.config.basic[i].innerHTML="<strong>B</strong>",this.config.basic[i].setAttribute("title","Bold"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"em"===i?(this.config.basic[i].innerHTML="<em>I</em>",this.config.basic[i].setAttribute("title","Italic"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"em"===i?(this.config.basic[i].innerHTML="<em>I</em>",this.config.basic[i].setAttribute("title","Italic"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"mark"===i||("sup"===i?(this.config.basic[i].innerHTML="<sup>sup</sup>",this.config.basic[i].setAttribute("title","Superscript"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"sub"===i?(this.config.basic[i].innerHTML="<sub>sub</sub>",this.config.basic[i].setAttribute("title","Subscript"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"del"===i?(this.config.basic[i].innerHTML="<del>del</del>",this.config.basic[i].setAttribute("title","Deleted text"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):(this.config.basic[i].innerHTML="&crarr;",this.config.basic[i].setAttribute("title","Break line"),n.newLineBefore=!1,n.newLineAfter=!0,n.close=!1,n.inline=!0)),this.config.basic[i].addEventListener("click",function(){e.config.addHTMLElement(e.textareaElement,n)}),this.blocks.basic.domElement.appendChild(this.config.basic[i])},this),this.domElement.appendChild(this.blocks.basic.domElement)),this.config.types.indexOf("header")>-1&&(this.blocks.header={},this.blocks.header.domElement=t.createElement("div"),this.blocks.header.domElement.classList.add("elpmisFormatBar-headerBlock"),this.blocks.header.domElement.id="elpmisFormatBar-headerBlock"+this.textareaElement.elpmisId,this.config.hasOwnProperty("header")&&"object"==typeof this.config.header&&(this.blocks.header.selectElement=t.createElement("select"),this.blocks.header.selectElement.id="elpmisFormatBar-headerBlock-select"+this.textareaElement.elpmisId,this.config.header.forEach(function(e){this.config.header[e]=t.createElement("option"),this.config.header[e].setAttribute("value",e),this.config.header[e].innerHTML="Header "+e.substring(1),this.config.header[e].changeConfig={element:e,newLineBefore:!0,newLineAfter:!0,close:!0,inline:!1},this.blocks.header.selectElement.appendChild(this.config.header[e])},this),this.blocks.header.selectElement.addEventListener("change",function(){var t=e.blocks.header.selectElement.value;e.config.addHTMLElement(e.textareaElement,e.config.header[t].changeConfig)}),this.blocks.header.domElement.appendChild(this.blocks.header.selectElement)),this.domElement.appendChild(this.blocks.header.domElement)),this.config.types.indexOf("blocks")>-1&&(this.blocks.blocks={},this.blocks.blocks.domElement=t.createElement("div"),this.blocks.blocks.domElement.classList.add("elpmisFormatBar-blocksBlock"),this.blocks.blocks.domElement.id="elpmisFormatBar-blocksBlock"+this.textareaElement.elpmisId,this.config.hasOwnProperty("blocks")&&"object"==typeof this.config.blocks&&this.config.blocks.forEach(function(i){var n={};this.config.blocks[i]=t.createElement("button"),this.config.blocks[i].classList.add("elpmisFormatBar-blocksBlock-"+i+"Button"),this.config.blocks[i].id="elpmisFormatBar-blocksBlock-"+i+"Button"+this.textareaElement.elpmisId,n.element=i,"p"===i?(this.config.blocks[i].innerHTML="Paragraph",n.newLineBefore=!0,n.newLineAfter=!0,n.close=!0,n.inline=!1):"blockquote"===i?(this.config.blocks[i].innerHTML="&ldquo;Quotes&rdquo;",n.newLineBefore=!0,n.newLineAfter=!0,n.close=!0,n.inline=!1):"pre"===i&&(this.config.blocks[i].innerHTML="<pre>Pre</pre>",this.config.blocks[i].setAttribute("title","Preformatted text"),n.newLineBefore=!0,n.newLineAfter=!0,n.close=!0,n.inline=!1),this.config.blocks[i].addEventListener("click",function(){e.config.addHTMLElement(e.textareaElement,n)}),this.blocks.blocks.domElement.appendChild(this.config.blocks[i])},this),this.domElement.appendChild(this.blocks.blocks.domElement)),this.config.hasOwnProperty("special")&&"object"==typeof this.config.special&&(this.blocks.special={},this.blocks.special.domElement=t.createElement("div"),this.blocks.special.domElement.classList.add("elpmisFormatBar-specialBlock"),this.blocks.special.domElement.id="elpmisFormatBar-specialBlock"+this.textareaElement.elpmisId,this.config.hasOwnProperty("special")&&"object"==typeof this.config.special&&this.config.special.forEach(function(i){var n={};this.config.special[i]=t.createElement("button"),this.config.special[i].classList.add("elpmisFormatBar-specialBlock-"+i+"Button"),this.config.special[i].id="elpmisFormatBar-specialBlock-"+i+"Button"+this.textareaElement.elpmisId,n.element=i,"abbr"===i?(this.config.special[i].innerHTML="Abbr",this.config.special[i].setAttribute("title","Abbreviation"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"code"===i?(this.config.special[i].innerHTML="<code>Code</code>",n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0):"hr"===i&&(this.config.special[i].innerHTML="Line",n.newLineBefore=!0,n.newLineAfter=!0,n.close=!1,n.inline=!0),this.config.special[i].addEventListener("click",function(){e.config.addHTMLElement(e.textareaElement,n)}),this.blocks.special.domElement.appendChild(this.config.special[i])},this),this.domElement.appendChild(this.blocks.special.domElement))}}},r={pinStatus:!1,pinBtnOver:!1,contentElement:{},init:function(e){this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisPreviewElement"),this.domElement.classList.toggle("inactive"),this.domElement.setAttribute("tabindex",-1),this.domElement.id="elpmisPreviewElement"+this.textareaElement.elpmisId,this.init=function(){return!1}},toggle:function(){this.init()||this.pinStatus||this.pinBtnOver||(this.domElement.classList.toggle("active"),this.domElement.classList.toggle("inactive"))},hide:function(){this.init()||(this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"))},pinToggle:function(){this.init()||(this.pinStatus===!1?(this.pinStatus=!0,this.domElement.classList.remove("inactive"),this.domElement.classList.add("active"),this.domElement.classList.remove("pined"),this.domElement.classList.add("pined")):(this.pinStatus=!1,this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"),this.domElement.classList.remove("pined"),this.domElement.classList.add("unpined")))},updatePreview:function(){this.init()||(this.contentElement.innerHTML=this.textareaElement.value)},addToDOM:function(){if(!this.init()){var e=this;t.body.insertBefore(this.domElement,this.textareaElement),this.closeBtn=t.createElement("button"),this.closeBtn.classList.add("elpmisPreviewElement-closeBtn"),this.closeBtn.id="elpmisPreviewElement-closeBtn"+this.textareaElement.elpmisId,this.closeBtn.innerHTML="&times;",this.closeBtn.setAttribute("title","Close Elpmis Preview Element"),this.domElement.appendChild(this.closeBtn),this.closeBtn.addEventListener("click",function(){e.pinStatus&&e.pinToggle(),e.hide()}),this.pinBtn=t.createElement("button"),this.pinBtn.classList.add("elpmisPreviewElement-pinBtn"),this.pinBtn.id="elpmisPreviewElement-pinBtn"+this.textareaElement.elpmisId,this.pinBtn.innerHTML="&nabla;",this.pinBtn.setAttribute("title","Pin Elpmis Preview Element"),this.domElement.appendChild(this.pinBtn),this.pinBtn.addEventListener("click",function(){e.pinToggle()}),this.pinBtn.addEventListener("mouseover",function(){e.pinBtnOver=!0}),this.pinBtn.addEventListener("mouseout",function(){e.pinBtnOver=!1}),this.contentElement=t.createElement("div"),this.domElement.appendChild(this.contentElement)}},watch:function(){if(!this.init()){var e=this;i(e.textareaElement,["input","change","keyup","keydown","keypress"],function(){e.updatePreview()}),i(e.textareaElement,["focus","blur"],function(){e.toggle()})}},destroy:function(){this.init()||this.domElement.remove()}},h=function(e,i){function c(e){if(v){if(!B.silentMode)throw n(2);var t=n(2);console.error(t.toString())}else{e="object"==typeof e?e:{};var i=Object.create(l);i.init(e,B.types),i&&A.push(i)}}function h(e){var t=e.which||e.keyCode,i=e.shiftKey;B.blocks.indexOf("p")>-1&&(13!==t||i||(e.preventDefault(),d(this,{element:"p",newLineBefore:!0,newLineAfter:!0,inline:!1}))),B.basic.indexOf("br")>-1&&13===t&&i&&(e.preventDefault(),d(this,{element:"br",newLineAfter:!0,close:!1}))}function d(e,t){if(e){t="object"==typeof t?t:{},t.element=t.element||"p",t.newLineBefore=!!t.hasOwnProperty("newLineBefore")&&t.newLineBefore,t.newLineAfter=!!t.hasOwnProperty("newLineAfter")&&t.newLineAfter,t.close=!t.hasOwnProperty("close")||t.close,t.inline=!t.hasOwnProperty("inline")||t.inline;var i,n,s,o=e.selectionStart,l=e.selectionEnd,c="",a=0,r=e.value,h="",d=!1,m=/<*>/i;o!==l&&(c=r.substring(o,l),d=m.test(c)),n=r.substring(0,o).split("\n"),s=r.substring(l).split("\n"),i=n[n.length-1]+c+s[0],d||(d=m.test(i)),t.inline||""!==c&&!d?(h=r.substring(0,o),h+=t.inline&&t.newLineBefore?"\n":"",h+="<"+t.element+">",h+=r.substring(o,l),a=h.length,h+=t.close?"</"+t.element+">":"",h+=t.inline&&t.newLineAfter?"\n":"",t.newLineAfter&&(a=h.length),h+=r.substring(l)):(n.pop(),s.shift(),h=n.join("\n"),h+=t.newLineBefore?"\n":"",h+=i,h+=t.newLineBefore?"\n":"",h+="<"+t.element+">",a=h.length,h+=t.close?"</"+t.element+">":"",h+=t.newLineAfter?"\n":"",h+=s.join("\n")),e.focus(),e.value=h,e.selectionStart=e.selectionEnd=a,B.previewMode&&M[e.elpmisId].updatePreview()}}function m(e){var t=e.elpmisId;M[t]=Object.create(r),M[t].init(e),M[t].addToDOM(),M[t].watch(),M[t].updatePreview()}function p(e){var t=e.elpmisId;M[t].destroy()}function f(e){var t=e.elpmisId;T[t]=Object.create(a),T[t].init(e,{types:B.types,basic:B.basic,header:B.header,blocks:B.blocks,lists:B.lists,special:B.special,css:B.css,hyperlink:B.hyperlink,addHTMLElement:d})&&(T[t].addBlocks(),T[t].addToDOM())}function b(e){v||(v=!0,B.keyListen&&e.addEventListener("keypress",h),B.previewMode&&m(e),f(e))}function u(){w.forEach(b)}function E(){w.forEach(function(e){B.keyListen&&e.removeEventListener("keypress",h),B.previewMode&&p(e)}),v=!1}"object"==typeof e&&(i=e,e=!1);var g=e||".elpmis",L=g.substr(0,1),k=g.substr(1),B={},v=!1,w=[],y=!1,A=[],M=[],T=[];if("object"==typeof i&&null!==i?Object.keys(o).forEach(function(e){i.hasOwnProperty(e)?B[e]=i[e]:B[e]=o[e]}):B=o,!s[g]){switch(s[g]=!0,L){case"#":w[0]=t.getElementById(k);break;case".":y=t.getElementsByClassName(k);break;default:y=t.getElementsByTagName(g)}return y&&Array.prototype.forEach.call(y,function(e){w.push(e)}),w.forEach(function(e,t){e.elpmisId=t+1}),B.autoInit&&u(),{status:v,selector:g,options:B,elements:w,customComponents:A,previewElements:M,destroy:E,addCustomComponent:c,init:b,initAll:u,addHTMLElement:d}}if(!B.silentMode)throw n(1,[g]);var x=n(1,[g]);console.error(x.toString())};e.ElpmisEditor=h}(window,document);