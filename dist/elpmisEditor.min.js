!function(e,t){"use strict";function i(e,t,i){t.forEach(function(t){e.addEventListener(t,i)})}function n(e,t){var i=Object.create(a);return i.init(e,t),i}var s=[],o={autoInit:!0,silentMode:!0,previewMode:!0,keyListen:!0,types:["basic","header","blocks","lists","special","colors","hyperlink"],basic:["strong","em","mark","sup","sub","del","br"],header:["h1","h2","h3","h4","h5","h6"],blocks:["p","blockquote","pre"],lists:["ul","ol","dl"],special:["abbr","code","hr"],css:"class",hyperlink:!0},l={customComponentsLength:0,element:"span",type:"special",init:function(e,t){"object"==typeof e&&null!==e&&(this.id=++l.customComponentsLength,this.name=e.name||"customComponent"+this.id,e.element&&(this.element=e.element),this.class=e.class||"customClass"+this.id,t.indexOf(e.type)>-1&&(this.type=e.type),this.init=function(){return!1})}},a=Object.create(Error.prototype);Object.defineProperties(a,{name:{enumerable:!0,value:"ElpmisError"},started:{writable:!0,value:!1},messages:{value:["The number was not defined.","The element {{0}} is already been used. Use the destroy method before set it again.","Cannot add a customComponent to an element already started, set the autoInit option to false, add the customComponent then use init() or initAll(). You can look at the status property to check if the element was already started."]},message:{enumerable:!0,get:function(){if(this.started){var e=this.messages[this.number];return this.placeholders&&this.placeholders.forEach(function(t,i){e=e.split("{{"+i+"}}").join(t)}),e}return!1}},init:{value:function(e,t){this.started||(this.started=!0,this.number=e,this.placeholders=t)}}});var r={blocks:{},init:function(e,i){return"object"==typeof i&&(this.config=i,this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisFormatBar"),this.domElement.classList.toggle("inactive"),this.domElement.id="elpmisFormatBar"+this.textareaElement.elpmisId,void(this.init=function(){return!1}))},addToDOM:function(){this.init()||t.body.insertBefore(this.domElement,this.textareaElement)},addBlocks:function(){if(!this.init()){var e=this;this.config.types.indexOf("basic")>-1&&(this.blocks.basic={},this.blocks.basic.domElement=t.createElement("div"),this.blocks.basic.domElement.classList.add("elpmisFormatBar-basicBlock"),this.blocks.basic.domElement.id="elpmisFormatBar-basicBlock"+this.textareaElement.elpmisId,this.config.hasOwnProperty("basic")&&"object"==typeof this.config.basic&&this.config.basic.forEach(function(i){var n={};this.config.basic[i]=t.createElement("button"),this.config.basic[i].classList.add("elpmisFormatBar-basicBlock-"+i+"Button"),this.config.basic[i].id="elpmisFormatBar-basicBlock-"+i+"Button"+this.textareaElement.elpmisId,n.element=i,"strong"===i&&(this.config.basic[i].innerHTML="<strong>S</strong>",this.config.basic[i].setAttribute("title","Strong"),n.newLineBefore=!1,n.newLineAfter=!1,n.close=!0,n.inline=!0),this.config.basic[i].addEventListener("click",function(){e.config.addHTMLElement(e.textareaElement,n)}),this.blocks.basic.domElement.appendChild(this.config.basic[i])},this),this.domElement.appendChild(this.blocks.basic.domElement))}}},c={pinStatus:!1,pinBtnOver:!1,contentElement:{},init:function(e){this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisPreviewElement"),this.domElement.classList.toggle("inactive"),this.domElement.setAttribute("tabindex",-1),this.domElement.id="elpmisPreviewElement"+this.textareaElement.elpmisId,this.init=function(){return!1}},toggle:function(){this.init()||this.pinStatus||this.pinBtnOver||(this.domElement.classList.toggle("active"),this.domElement.classList.toggle("inactive"))},hide:function(){this.init()||(this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"))},pinToggle:function(){this.init()||(this.pinStatus===!1?(this.pinStatus=!0,this.domElement.classList.remove("inactive"),this.domElement.classList.add("active"),this.domElement.classList.remove("pined"),this.domElement.classList.add("pined")):(this.pinStatus=!1,this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"),this.domElement.classList.remove("pined"),this.domElement.classList.add("unpined")))},updatePreview:function(){this.init()||(this.contentElement.innerHTML=this.textareaElement.value)},addToDOM:function(){if(!this.init()){var e=this;t.body.insertBefore(this.domElement,this.textareaElement),this.closeBtn=t.createElement("button"),this.closeBtn.classList.add("elpmisPreviewElement-closeBtn"),this.closeBtn.id="elpmisPreviewElement-closeBtn"+this.textareaElement.elpmisId,this.closeBtn.innerHTML="&times;",this.closeBtn.setAttribute("title","Close Elpmis Preview Element"),this.domElement.appendChild(this.closeBtn),this.closeBtn.addEventListener("click",function(){e.pinStatus&&e.pinToggle(),e.hide()}),this.pinBtn=t.createElement("button"),this.pinBtn.classList.add("elpmisPreviewElement-pinBtn"),this.pinBtn.id="elpmisPreviewElement-pinBtn"+this.textareaElement.elpmisId,this.pinBtn.innerHTML="&nabla;",this.pinBtn.setAttribute("title","Pin Elpmis Preview Element"),this.domElement.appendChild(this.pinBtn),this.pinBtn.addEventListener("click",function(){e.pinToggle()}),this.pinBtn.addEventListener("mouseover",function(){e.pinBtnOver=!0}),this.pinBtn.addEventListener("mouseout",function(){e.pinBtnOver=!1}),this.contentElement=t.createElement("div"),this.domElement.appendChild(this.contentElement)}},watch:function(){if(!this.init()){this.updatePreview();var e=this;i(e.textareaElement,["input","change","keyup","keydown","keypress"],function(){e.updatePreview()}),i(e.textareaElement,["focus","blur"],function(){e.toggle()})}},destroy:function(){this.init()||this.domElement.remove()}},m=function(e,i){function a(e){if(w){if(!y.silentMode)throw n(2);var t=n(2);console.error(t.toString())}else{e="object"==typeof e?e:{};var i=Object.create(l);i.init(e,y.types),i&&O.push(i)}}function m(e){var t=e.which||e.keyCode,i=e.shiftKey;y.blocks.indexOf("p")>-1&&(13!==t||i||(e.preventDefault(),d(this,{element:"p",newLineBefore:!0,newLineAfter:!0,inline:!1}))),y.basic.indexOf("br")>-1&&13===t&&i&&(e.preventDefault(),d(this,{element:"br",newLineAfter:!0,close:!1}))}function d(e,t){if(e){t="object"==typeof t?t:{},t.element=t.element||"p",t.newLineBefore=!!t.hasOwnProperty("newLineBefore")&&t.newLineBefore,t.newLineAfter=!!t.hasOwnProperty("newLineAfter")&&t.newLineAfter,t.close=!t.hasOwnProperty("close")||t.close,t.inline=!t.hasOwnProperty("inline")||t.inline;var i,n,s,o=e.selectionStart,l=e.selectionEnd,a="",r=0,c=e.value,m="",d=!1,h=/<*>/i;o!==l&&(a=c.substring(o,l),d=h.test(a)),n=c.substring(0,o).split("\n"),s=c.substring(l).split("\n"),i=n[n.length-1]+a+s[0],d||(d=h.test(i)),t.inline||""!==a&&!d?(m=c.substring(0,o),m+=t.inline&&t.newLineBefore?"\n":"",m+="<"+t.element+">",m+=c.substring(o,l),r=m.length,m+=t.close?"</"+t.element+">":"",m+=t.inline&&t.newLineAfter?"\n":"",t.newLineAfter&&(r=m.length),m+=c.substring(l)):(n.pop(),s.shift(),m=n.join("\n"),m+=t.newLineBefore?"\n":"",m+=i,m+=t.newLineBefore?"\n":"",m+="<"+t.element+">",r=m.length,m+=t.close?"</"+t.element+">":"",m+=t.newLineAfter?"\n":"",m+=s.join("\n")),e.focus(),e.value=m,e.selectionStart=e.selectionEnd=r}}function h(e){var t=e.elpmisId;P[t]=Object.create(c),P[t].init(e),P[t].updatePreview(),P[t].addToDOM(),P[t].watch()}function p(e){var t=e.elpmisId;P[t].destroy()}function u(e){var t=e.elpmisId;x[t]=Object.create(r),x[t].init(e,{types:y.types,basic:y.basic,header:y.header,blocks:y.blocks,lists:y.lists,special:y.special,css:y.css,hyperlink:y.hyperlink,addHTMLElement:d}),x[t].addBlocks(),x[t].addToDOM()}function f(e){w||(w=!0,y.keyListen&&e.addEventListener("keypress",m),y.previewMode&&h(e),u(e))}function E(){B.forEach(f)}function b(){B.forEach(function(e){y.keyListen&&e.removeEventListener("keypress",m),y.previewMode&&p(e)}),w=!1}"object"==typeof e&&(i=e,e=!1);var v=e||".elpmis",g=v.substr(0,1),L=v.substr(1),y={},w=!1,B=[],k=!1,O=[],P=[],x=[];if("object"==typeof i&&null!==i?Object.keys(o).forEach(function(e){i.hasOwnProperty(e)?y[e]=i[e]:y[e]=o[e]}):y=o,!s[v]){switch(s[v]=!0,g){case"#":B[0]=t.getElementById(L);break;case".":k=t.getElementsByClassName(L);break;default:k=t.getElementsByTagName(v)}return k&&Array.prototype.forEach.call(k,function(e){B.push(e)}),B.forEach(function(e,t){e.elpmisId=t+1}),y.autoInit&&E(),{status:w,selector:v,options:y,elements:B,customComponents:O,previewElements:P,destroy:b,addCustomComponent:a,init:f,initAll:E,addHTMLElement:d}}if(!y.silentMode)throw n(1,[v]);var C=n(1,[v]);console.error(C.toString())};e.ElpmisEditor=m}(window,document);