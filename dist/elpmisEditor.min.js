!function(e,t){"use strict";function n(e,t,n){t.forEach(function(t){e.addEventListener(t,n)})}function i(e,t){var n=Object.create(a);return n.init(e,t),n}var s=[],r={autoInit:!0,silentMode:!0,previewMode:!0,keyListen:!0,types:["basic","header","blocks","lists","special","colors","hyperlink"],basic:["strong","em","mark","sup","sub","del","br"],header:["h1","h2","h3","h4","h5","h6"],blocks:["p","blockquote","pre"],lists:["ul","ol","dl"],special:["abbr","code","hr"],colors:"class",hyperlink:!0},o={customComponentsLength:0,init:function(e,t){"object"==typeof e&&null!==e&&(this.id=++o.customComponentsLength,this.name=e.name||"customComponent"+this.id,this.element=e.element||"span",this.class=e.class||"customClass"+this.id,this.type=t.indexOf(e.type)>-1?e.type:"special",this.init=function(){return!1})}},a=Object.create(Error);Object.defineProperty(a,"name",{enumerable:!0,value:"ElpmisError"}),Object.defineProperty(a,"started",{writable:!0,value:!1}),Object.defineProperty(a,"messages",{value:["The number was not defined.","The element {{0}} is already been used. Use the destroy method before set it again.","Cannot add a customComponent to an element already started, set the autoInit option to false, add the customComponent then use init() or initAll(). You can look at the status property to check if the element was already started."]}),Object.defineProperty(a,"message",{enumerable:!0,get:function(){if(this.started){var e=this.messages[this.number];return this.placeholders&&this.placeholders.forEach(function(t,n){e=e.split("{{"+n+"}}").join(t)}),e}return!1}}),Object.defineProperty(a,"init",{enumerable:!0,value:function(e,t){this.started||(this.started=!0,this.number=e,this.placeholders=t,this.stack=(new Error).stack)}}),Object.defineProperty(a,"logError",{enumerable:!0,value:function(){this.started&&console.error(this.name+":",this.number,this.message)}});var l={init:function(e){this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisPreviewElement"),this.domElement.classList.add("active"),this.domElement.id="elpmisPreviewElement"+this.textareaElement.elpmisId,this.init=function(){return!1}},updatePreview:function(){this.domElement.innerHTML=this.textareaElement.value},addToDOM:function(){t.body.insertBefore(this.domElement,this.textareaElement)},watch:function(){var e=this;n(e.textareaElement,["input","change","keyup","keydown","keypress"],function(){e.updatePreview()})}},c=function(e,n){function a(e){if(E){if(!w.silentMode)throw i(2);i(2).logError()}else{e="object"==typeof e?e:{};var t=Object.create(o);t.init(e,w.types),t&&L.push(t)}}function c(e){e.addEventListener("keypress",function(t){var n=t.which||t.keyCode,i=t.shiftKey;w.blocks.indexOf("p")>-1&&(13!==n||i||(t.preventDefault(),u(e,{element:"p",newLineBefore:!0,newLineAfter:!0,inline:!1}))),w.basic.indexOf("br")>-1&&13===n&&i&&(t.preventDefault(),u(e,{element:"br",newLineAfter:!0,close:!1}))})}function u(e,t){if(e){t="object"==typeof t?t:{},t.element=t.element||"p",t.newLineBefore=!!t.hasOwnProperty("newLineBefore")&&t.newLineBefore,t.newLineAfter=!!t.hasOwnProperty("newLineAfter")&&t.newLineAfter,t.close=!t.hasOwnProperty("close")||t.close,t.inline=!t.hasOwnProperty("inline")||t.inline;var n,i,s,r=e.selectionStart,o=e.selectionEnd,a="",l=0,c=e.value,u="",h=!1,d=/<*>/i;r!==o&&(a=c.substring(r,o),h=d.test(a)),i=c.substring(0,r).split("\n"),s=c.substring(o).split("\n"),n=i[i.length-1]+a+s[0],h||(h=d.test(n)),t.inline||""!==a&&!h?(u=c.substring(0,r),u+=t.inline&&t.newLineBefore?"\n":"",u+="<"+t.element+">",u+=c.substring(r,o),t.newLineBefore&&(l=u.length),u+=t.close?"</"+t.element+">":"",u+=t.inline&&t.newLineAfter?"\n":"",t.newLineAfter&&(l=u.length),u+=c.substring(o)):(i.pop(),s.shift(),u=i.join("\n"),u+=t.newLineBefore?"\n":"",u+=n,u+=t.newLineBefore?"\n":"",u+="<"+t.element+">",l=u.length,u+=t.close?"</"+t.element+">":"",u+=t.newLineAfter?"\n":"",u+=s.join("\n")),e.value=u,e.selectionStart=e.selectionEnd=l}}function h(e){var t=e.elpmisId;k[t]=Object.create(l),k[t].init(e),k[t].updatePreview(),k[t].addToDOM(),k[t].watch()}function d(e){E||(E=!0,w.keyListen&&c(e),w.previewMode&&h(e))}function m(){v.forEach(d)}function f(){s[p]=!1;var e=Object.keys(this);e.forEach(function(e){delete this[e]},this)}"object"==typeof e&&(n=e,e=!1);var p=e||".elpmis",b=p.substr(0,1),y=p.substr(1),w={},E=!1,v=[],g=!1,L=[],k=[];if("object"==typeof n&&null!==n?Object.keys(r).forEach(function(e){n.hasOwnProperty(e)?w[e]=n[e]:w[e]=r[e]}):w=r,!s[p]){switch(s[p]=!0,b){case"#":v[0]=t.getElementById(y);break;case".":g=t.getElementsByClassName(y);break;default:g=t.getElementsByTagName(p)}return g&&Array.prototype.forEach.call(g,function(e){v.push(e)}),v.forEach(function(e,t){e.elpmisId=t}),w.autoInit&&m(),{status:E,selector:p,options:w,elements:v,customComponents:L,previewElements:k,destroy:f,addCustomComponent:a,init:d,initAll:m,addHTMLElement:u}}if(!w.silentMode)throw i(1,[p]);i(1,[p]).logError()};e.ElpmisEditor=c}(window,document);