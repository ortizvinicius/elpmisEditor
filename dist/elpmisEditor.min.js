!function(e,t){"use strict";function n(e,t,n){t.forEach(function(t){e.addEventListener(t,n)})}function i(e,t){var n=Object.create(r);return n.init(e,t),n}var s=[],o={autoInit:!0,silentMode:!0,previewMode:!0,keyListen:!0,types:["basic","header","blocks","lists","special","colors","hyperlink"],basic:["strong","em","mark","sup","sub","del","br"],header:["h1","h2","h3","h4","h5","h6"],blocks:["p","blockquote","pre"],lists:["ul","ol","dl"],special:["abbr","code","hr"],css:"class",hyperlink:!0},l={customComponentsLength:0,element:"span",type:"special",init:function(e,t){"object"==typeof e&&null!==e&&(this.id=++l.customComponentsLength,this.name=e.name||"customComponent"+this.id,e.element&&(this.element=e.element),this.class=e.class||"customClass"+this.id,t.indexOf(e.type)>-1&&(this.type=e.type),this.init=function(){return!1})}},r=Object.create(Error.prototype);Object.defineProperties(r,{name:{enumerable:!0,value:"ElpmisError"},started:{writable:!0,value:!1},messages:{value:["The number was not defined.","The element {{0}} is already been used. Use the destroy method before set it again.","Cannot add a customComponent to an element already started, set the autoInit option to false, add the customComponent then use init() or initAll(). You can look at the status property to check if the element was already started."]},message:{enumerable:!0,get:function(){if(this.started){var e=this.messages[this.number];return this.placeholders&&this.placeholders.forEach(function(t,n){e=e.split("{{"+n+"}}").join(t)}),e}return!1}},init:{value:function(e,t){this.started||(this.started=!0,this.number=e,this.placeholders=t)}}});var a={pinStatus:!1,pinBtnOver:!1,contentElement:{},init:function(e){this.textareaElement=e,this.domElement=t.createElement("div"),this.domElement.classList.add("elpmisPreviewElement"),this.domElement.classList.toggle("inactive"),this.domElement.setAttribute("tabindex",-1),this.domElement.id="elpmisPreviewElement"+this.textareaElement.elpmisId,this.init=function(){return!1}},toggle:function(){this.init()||this.pinStatus||this.pinBtnOver||(this.domElement.classList.toggle("active"),this.domElement.classList.toggle("inactive"))},hide:function(){this.init()||(this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"))},pinToggle:function(){this.init()||(this.pinStatus===!1?(this.pinStatus=!0,this.domElement.classList.remove("inactive"),this.domElement.classList.add("active"),this.domElement.classList.remove("pined"),this.domElement.classList.add("pined")):(this.pinStatus=!1,this.domElement.classList.remove("active"),this.domElement.classList.add("inactive"),this.domElement.classList.remove("pined"),this.domElement.classList.add("unpined")))},updatePreview:function(){this.init()||(this.contentElement.innerHTML=this.textareaElement.value)},addToDOM:function(){if(!this.init()){var e=this;t.body.insertBefore(this.domElement,this.textareaElement),this.closeBtn=t.createElement("button"),this.closeBtn.classList.add("elpmisPreviewElement-closeBtn"),this.closeBtn.id="elpmisPreviewElement-closeBtn"+this.textareaElement.elpmisId,this.closeBtn.innerHTML="&times;",this.closeBtn.setAttribute("title","Close Elpmis Preview Element"),this.domElement.appendChild(this.closeBtn),this.closeBtn.addEventListener("click",function(){e.pinStatus&&e.pinToggle(),e.hide()}),this.pinBtn=t.createElement("button"),this.pinBtn.classList.add("elpmisPreviewElement-pinBtn"),this.pinBtn.id="elpmisPreviewElement-pinBtn"+this.textareaElement.elpmisId,this.pinBtn.innerHTML="&nabla;",this.pinBtn.setAttribute("title","Pin Elpmis Preview Element"),this.domElement.appendChild(this.pinBtn),this.pinBtn.addEventListener("click",function(){e.pinToggle()}),this.pinBtn.addEventListener("mouseover",function(){e.pinBtnOver=!0}),this.pinBtn.addEventListener("mouseout",function(){e.pinBtnOver=!1}),this.contentElement=t.createElement("div"),this.domElement.appendChild(this.contentElement)}},watch:function(){if(!this.init()){var e=this;n(e.textareaElement,["input","change","keyup","keydown","keypress"],function(){e.updatePreview()}),n(e.textareaElement,["focus","blur"],function(){e.toggle()})}},destroy:function(){this.init()||this.domElement.remove()}},c=function(e,n){function r(e){if(L){if(!w.silentMode)throw i(2);var t=i(2);console.error(t.toString())}else{e="object"==typeof e?e:{};var n=Object.create(l);n.init(e,w.types),n&&B.push(n)}}function c(e){var t=e.which||e.keyCode,n=e.shiftKey;w.blocks.indexOf("p")>-1&&(13!==t||n||(e.preventDefault(),m(this,{element:"p",newLineBefore:!0,newLineAfter:!0,inline:!1}))),w.basic.indexOf("br")>-1&&13===t&&n&&(e.preventDefault(),m(this,{element:"br",newLineAfter:!0,close:!1}))}function m(e,t){if(e){t="object"==typeof t?t:{},t.element=t.element||"p",t.newLineBefore=!!t.hasOwnProperty("newLineBefore")&&t.newLineBefore,t.newLineAfter=!!t.hasOwnProperty("newLineAfter")&&t.newLineAfter,t.close=!t.hasOwnProperty("close")||t.close,t.inline=!t.hasOwnProperty("inline")||t.inline;var n,i,s,o=e.selectionStart,l=e.selectionEnd,r="",a=0,c=e.value,m="",h=!1,d=/<*>/i;o!==l&&(r=c.substring(o,l),h=d.test(r)),i=c.substring(0,o).split("\n"),s=c.substring(l).split("\n"),n=i[i.length-1]+r+s[0],h||(h=d.test(n)),t.inline||""!==r&&!h?(m=c.substring(0,o),m+=t.inline&&t.newLineBefore?"\n":"",m+="<"+t.element+">",m+=c.substring(o,l),t.newLineBefore&&(a=m.length),m+=t.close?"</"+t.element+">":"",m+=t.inline&&t.newLineAfter?"\n":"",t.newLineAfter&&(a=m.length),m+=c.substring(l)):(i.pop(),s.shift(),m=i.join("\n"),m+=t.newLineBefore?"\n":"",m+=n,m+=t.newLineBefore?"\n":"",m+="<"+t.element+">",a=m.length,m+=t.close?"</"+t.element+">":"",m+=t.newLineAfter?"\n":"",m+=s.join("\n")),e.value=m,e.selectionStart=e.selectionEnd=a}}function h(e){var t=e.elpmisId;k[t]=Object.create(a),k[t].init(e),k[t].updatePreview(),k[t].addToDOM(),k[t].watch()}function d(e){var t=e.elpmisId;k[t].destroy()}function p(e){L||(L=!0,w.keyListen&&e.addEventListener("keypress",c),w.previewMode&&h(e))}function u(){y.forEach(p)}function f(){y.forEach(function(e){w.keyListen&&e.removeEventListener("keypress",c),w.previewMode&&d(e)}),L=!1}"object"==typeof e&&(n=e,e=!1);var E=e||".elpmis",v=E.substr(0,1),b=E.substr(1),w={},L=!1,y=[],g=!1,B=[],k=[];if("object"==typeof n&&null!==n?Object.keys(o).forEach(function(e){n.hasOwnProperty(e)?w[e]=n[e]:w[e]=o[e]}):w=o,!s[E]){switch(s[E]=!0,v){case"#":y[0]=t.getElementById(b);break;case".":g=t.getElementsByClassName(b);break;default:g=t.getElementsByTagName(E)}return g&&Array.prototype.forEach.call(g,function(e){y.push(e)}),y.forEach(function(e,t){e.elpmisId=t+1}),w.autoInit&&u(),{status:L,selector:E,options:w,elements:y,customComponents:B,previewElements:k,destroy:f,addCustomComponent:r,init:p,initAll:u,addHTMLElement:m}}if(!w.silentMode)throw i(1,[E]);var O=i(1,[E]);console.error(O.toString())};e.ElpmisEditor=c}(window,document);